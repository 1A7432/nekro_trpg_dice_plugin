# TRPG提示词注入系统示例

这个文档展示了TRPG骰子系统的智能提示词注入功能如何让AI成为专业的KP/DM。

## 🎯 提示词注入系统概览

我们实现了5个核心提示词注入方法，每个都针对不同的场景和需求：

### 1. **系统基础意识** (`trpg_system_awareness`)
- **目的**: 让AI了解自己是TRPG主持人助手
- **内容**: 介绍可用工具和核心职责
- **触发**: 每次对话都会注入

### 2. **游戏状态感知** (`current_game_state`)  
- **目的**: 提供当前游戏的实时状态信息
- **内容**: 角色信息、先攻状态、可用文档等
- **触发**: 动态获取最新状态

### 3. **系统专业知识** (`game_system_expertise`)
- **目的**: 根据当前游戏系统提供专业指导
- **内容**: COC7/DND5E/WOD等系统的专业KP/DM知识
- **触发**: 基于角色卡的游戏系统类型

### 4. **文档上下文** (`document_context_awareness`)
- **目的**: 基于已上传文档提供背景信息
- **内容**: 相关模组、规则、故事背景
- **触发**: 根据对话内容智能检索

### 5. **交互风格** (`trpg_interaction_style`)
- **目的**: 定义TRPG特有的叙述和交互方式
- **内容**: 专业的表达模式和互动原则
- **触发**: 始终生效

## 🎮 实际使用场景演示

### 场景1: COC7跑团开始

**游戏状态:**
- 玩家创建了调查员"艾莉娅"
- 使用COC7系统
- 上传了"深海古城"模组文档

**AI接收到的提示词:**
```
# TRPG游戏主持人助手身份
你是一个专业的TRPG游戏主持人助手，精通多种TRPG系统...

# 当前游戏状态
## 当前角色: 艾莉娅
• 游戏系统: CoC
• 年龄: 28
• 职业: 记者
• 关键属性: STR:65, CON:70, DEX:75, INT:80, SAN:65, HP:13

## 可用文档资料:
• 📘module:1个
• 使用文档搜索工具获取详细信息

# 克苏鲁的呼唤 (COC7) 专业指导
## 作为Keeper的核心职责:
• 恐怖氛围营造: 重视心理恐怖，逐步揭示真相
• 理智值管理: 适时进行理智检定，控制疯狂进程...

# 相关背景资料
基于当前会话上下文，以下文档可能相关:
## 📘 深海古城模组 (相似度: 85%)
内容摘要: 一个偏远的海滨小镇最近发生了一系列诡异事件...

# TRPG交互风格指导
## 叙述风格:
• 描述性语言: 使用丰富的感官描述营造氛围
• 第二人称视角: "你看到..."、"你感觉到..."...
```

**AI的表现:**
AI会自动理解自己是COC7的Keeper，知道要营造恐怖氛围，会主动使用`ra`命令进行技能检定，在合适时机进行理智检定，并能引用"深海古城"模组的具体内容。

### 场景2: DND5E战斗场景

**游戏状态:**
- 角色"格里芬"(战士)
- DND5E系统
- 当前正在先攻追踪中

**AI接收到的提示词:**
```
# 当前游戏状态
## 当前角色: 格里芬
• 游戏系统: DnD5e
• 职业: 战士

## 战斗状态: 先攻追踪中
• 当前先攻顺序: 4个角色
• 使用ri命令管理先攻顺序

# 龙与地下城 5E (DND5E) 专业指导
## 作为DM的核心职责:
• 英雄叙事: 强调英雄主义和团队合作
• 战术战斗: 精确管理先攻、距离、法术效果...

## 战斗管理:
• 使用先攻追踪系统维护战斗顺序
• 明确说明战术选项和环境因素...
```

**AI的表现:**
AI会专注于战术战斗管理，使用`adv`/`dis`命令处理优势劣势，主动管理先攻顺序，鼓励玩家使用创意战术。

### 场景3: 规则查询场景

**游戏状态:**
- 上传了DND5E规则书
- 玩家询问法术相关规则

**AI接收到的提示词:**
```
# 可用文档资料:
• 📜rule:1个 (DND5E核心规则书)

# 相关背景资料
基于当前会话上下文，以下文档可能相关:
## 📜 DND5E核心规则书 (相似度: 92%)
内容摘要: 法术位系统说明：法师每天能够施展的法术数量有限...
```

**AI的表现:**
AI会自动搜索规则文档，引用准确的规则条文，提供权威的裁定建议。

## 🔧 技术实现亮点

### 动态状态感知
- **实时角色信息**: 自动获取当前角色的属性、系统类型
- **战斗状态检测**: 智能识别是否在战斗中
- **文档库感知**: 知道玩家上传了什么类型的文档

### 智能上下文匹配
- **语义搜索**: 基于对话内容智能检索相关文档
- **系统适配**: 根据游戏系统自动切换专业知识
- **场景识别**: 识别当前是战斗、调查还是角色扮演场景

### 专业知识注入
- **分系统指导**: COC7恐怖氛围 vs DND5E英雄叙事 vs WOD个人恐怖
- **工具使用**: 明确指导何时使用哪些命令
- **风格一致**: 保持专业的TRPG叙述风格

## 🎭 AI行为变化对比

### 没有提示词注入时:
```
用户: "我想调查这个房间"
AI: "好的，你可以调查房间。请告诉我你想做什么。"
```

### 有提示词注入后:
```
用户: "我想调查这个房间"
AI: "请进行一个侦察检定，看看你能发现什么线索。
[使用ra命令: ra 侦察]

你仔细搜查房间，注意力集中在任何可能隐藏秘密的地方。墙壁上是否有暗门的痕迹？书架后面会不会藏着什么？地板上的灰尘分布是否有异常？

根据你的检定结果，我会描述你所发现的内容。这里的氛围让你感到微微不安，仿佛有什么东西在暗中注视着你..."
```

## 🚀 系统优势

### 1. **智能化程度高**
- AI自动理解游戏状态
- 主动使用合适的工具
- 提供专业的游戏体验

### 2. **适应性强**
- 支持多种TRPG系统
- 根据文档内容调整行为
- 实时响应游戏状态变化

### 3. **用户体验优秀**
- 无需手动指导AI使用工具
- 自然的游戏主持风格
- 专业的规则裁定能力

### 4. **扩展性好**
- 易于添加新的游戏系统支持
- 可以根据需要调整提示词
- 支持更复杂的场景识别

这个提示词注入系统将简单的工具集合转变成了真正智能的TRPG助手，让AI能够像经验丰富的KP/DM一样主持游戏！