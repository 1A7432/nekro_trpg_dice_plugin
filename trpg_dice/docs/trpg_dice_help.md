# TRPG 骰子系统使用手册

## 概述

这是一个功能完善的TRPG骰子系统插件，参考OlivaDice标准，支持多种TRPG规则和复杂骰子表达式，为跑团提供全面的掷骰支持。

## 基础掷骰指令

### 基本掷骰
- `r <表达式>` - 基础掷骰
  - `r d20` - 掷一个20面骰子
  - `r 3d6+2` - 掷3个6面骰子加2
  - `r 2d10+5` - 掷2个10面骰子加5
  - `r d4+d6+d8` - 掷多种骰子组合

### 隐藏掷骰
- `rh <表达式>` - 隐藏掷骰（只显示结果，不显示过程）
  - `rh d20+5` - 暗骰，只显示最终结果

## 优势/劣势系统（D&D 5E）

### 优势掷骰
- `adv` 或 `advantage` - 优势掷骰（掷两次取高）
  - `adv` - 优势d20
  - `adv +5` - 优势d20+5

### 劣势掷骰
- `dis` 或 `disadvantage` - 劣势掷骰（掷两次取低）
  - `dis` - 劣势d20
  - `dis +3` - 劣势d20+3

## 技能检定系统

### 基础技能检定
- `ra <技能> [技能值]` - 技能检定
  - `ra 侦察` - 使用角色卡中的侦察技能
  - `ra 力量 65` - 指定技能值进行检定
  - `ra 心理学 80` - 心理学技能检定（技能值80）

### 隐藏技能检定
- `rah <技能> [技能值]` - 隐藏技能检定（只显示成功/失败）
  - `rah 聆听` - 暗中进行聆听检定

### 对抗检定
- `rav <技能1>vs<技能2>` - 对抗检定
  - `rav 心理学vs欺骗` - 心理学对抗欺骗
  - `rav 力量 65vs敏捷 70` - 指定数值的对抗检定

## 角色扮演系统

### 角色动作
- `me <动作>` - 角色动作描述
  - `me 小心翼翼地推开房门`
  - `me 向前冲锋，挥舞着剑`

## 角色卡管理系统（.st）

### 查看角色卡
- `st` - 显示当前角色卡简要信息
- `st show` - 显示角色卡详细信息

### 创建和切换角色卡
- `st new <角色名> [系统]` - 创建新角色卡
  - `st new 艾莉娅 CoC` - 创建CoC系统角色卡
  - `st new 莉莉丝 DnD5e` - 创建D&D 5E系统角色卡
- `st set <角色名>` - 切换到指定角色卡
- `st list` - 列出所有角色卡

### 设置角色属性
- `st <属性名> <数值>` - 设置属性或技能
  - `st 力量 65` - 设置力量属性为65
  - `st 侦察 75` - 设置侦察技能为75
  - `st 克苏鲁神话 5` - 设置克苏鲁神话技能为5

## TRPG规则系统

### 克苏鲁的呼唤（CoC）

#### 技能检定
- `coc <技能值> [困难度]` - CoC技能检定
  - `coc 60` - 普通检定（技能值60）
  - `coc 75 困难` - 困难检定
  - `coc 80 极难` - 极难检定

#### 理智检定
- `san <理智值> <成功损失>/<失败损失>` - 理智检定
  - `san 65 1/1d4` - 理智检定，成功损失1点，失败损失1d4点
  - `san 70 0/1d6` - 理智检定，成功无损失，失败损失1d6点

#### CoC角色生成
- `cocchar` 或 `coc` - 自动生成CoC角色
  - 自动生成3d6*5的属性
  - 随机职业和年龄
  - 年龄调整机制

### D&D 5E 系统

#### 能力检定
- `check <属性> [熟练]` - 能力检定
  - `check 力量` - 力量检定
  - `check 敏捷 熟练` - 敏捷检定（带熟练加值）

#### 豁免检定
- `save <属性> [熟练]` - 豁免检定
  - `save 体质` - 体质豁免
  - `save 智力 熟练` - 智力豁免（带熟练加值）

#### D&D角色生成
- `dndchar` 或 `dnd` - 自动生成D&D 5E角色
  - 4d6去掉最小值生成属性
  - 随机种族和职业
  - 种族属性调整

#### 先攻检定
- `init [修正]` - 先攻检定
  - `init` - 基础先攻
  - `init +2` - 先攻+2

### 黑暗世界（WoD）

#### 骰池检定
- `wod <骰池大小> [困难度]` 或 `w <骰池大小> [困难度]`
  - `wod 5` - 5个d10，困难度6
  - `wod 6 8` - 6个d10，困难度8

## 生命值和状态管理

### 生命值管理
- `hp` - 查看当前生命值
- `hp +<数值>` - 恢复生命值
  - `hp +5` - 恢复5点生命值
- `hp -<数值>` - 损失生命值
  - `hp -8` - 损失8点生命值
- `hp <当前值>/<最大值>` - 设置生命值
  - `hp 25/30` - 设置生命值为25/30
- `hp <当前值>` - 只设置当前生命值

## 战斗和先攻系统

### 先攻追踪
- `ri +<角色名>` - 添加角色到先攻列表
- `ri list` - 查看先攻顺序
- `ri clear` - 清空先攻列表

## 高级掷骰功能

### 多次掷骰
- `rn <次数> <表达式>` 或 `repeat <次数> <表达式>`
  - `rn 3 d20+5` - 掷3次d20+5
  - `repeat 5 3d6` - 掷5次3d6

### 爆炸骰（开放性骰子）
- `explode <表达式>` 或 `ex <表达式>` - 爆炸骰
  - `ex d10` - d10爆炸骰（掷出10继续掷）
  - `explode 2d6` - 2个d6爆炸骰

### Fate 骰子
- `fate [数量] [修正]` 或 `f [数量] [修正]`
  - `fate` - 4个Fate骰子（默认）
  - `f 3` - 3个Fate骰子
  - `fate +2` - 4个Fate骰子+2

## 辅助功能

### 随机姓名生成
- `name [参数]` - 随机姓名生成
  - `name` - 随机中文姓名
  - `name en` - 英文姓名
  - `name 男` - 男性姓名
  - `name 女 3` - 生成3个女性姓名
  - `name en male 2` - 生成2个英文男性姓名

### 疯狂症状表
- `madness [类型]` 或 `mad [类型]` - 随机疯狂症状
  - `madness` - 临时疯狂症状
  - `mad 不定疯狂` - 不定疯狂症状
  - `madness 总结疯狂` - 总结疯狂症状

### 今日人品
- `jrrp` - 今日人品检定
  - 基于用户ID和日期生成固定的日运值
  - 包含人品等级判定

### 抽卡功能
- `draw [数量]` - 抽取标准扑克牌
  - `draw` - 抽1张牌
  - `draw 5` - 抽5张牌

## 系统功能

### 机器人状态
- `bot` - 查看机器人状态
- `bot on/off` - 启用/禁用功能

### 帮助系统
- `help trpg` - 查看TRPG系统帮助

## 骰子表达式语法

### 基础语法
- `d<面数>` - 单个骰子（如 d20, d6）
- `<数量>d<面数>` - 多个骰子（如 3d6, 2d10）
- `+<数值>` / `-<数值>` - 加减修正值（如 +5, -2）

### 复合表达式
- `3d6+2d4+5` - 多种骰子组合
- `d20+d6+3` - 不同骰子和修正值

### 特殊规则
- 优势：掷两次d20取最高
- 劣势：掷两次d20取最低
- 爆炸骰：掷出最大值时继续掷骰
- Fate骰子：结果为-1、0、+1

## 成功程度判定

### CoC系统成功程度
- **大成功**：掷出1
- **极难成功**：≤技能值/5
- **困难成功**：≤技能值/2
- **成功**：≤技能值
- **失败**：>技能值
- **大失败**：掷出96-100

### 对抗检定规则
1. 双方都成功：比较成功程度
2. 成功程度相同：骰点低者胜
3. 仅一方成功：成功方胜利
4. 双方都失败：骰点低者胜

## 大成功/大失败

系统自动检测并提示：
- ✨ 大成功：掷出骰子最大值
- 💥 大失败：掷出骰子最小值（1）

## 角色卡系统详解

### CoC角色卡
- **主属性**：力量、体质、体型、敏捷、外貌、智力、意志、教育、幸运
- **派生属性**：理智、魔法、生命值、体力
- **技能系统**：包含所有CoC标准技能
- **职业系统**：随机职业分配

### D&D 5E角色卡
- **六大属性**：力量、敏捷、体质、智力、感知、魅力
- **派生属性**：生命值、护甲等级、先攻修正、熟练加值
- **种族职业**：随机种族和职业组合

## 配置选项

插件支持以下配置：
- `MAX_DICE_COUNT`: 单次最大骰子数量（默认100）
- `MAX_DICE_SIDES`: 骰子最大面数（默认1000）
- `DEFAULT_DICE_TYPE`: 默认骰子类型（默认d20）
- `ENABLE_CRITICAL_EFFECTS`: 启用大成功/大失败（默认开启）
- `AUTO_SAVE_CHARACTERS`: 自动保存角色数据（默认开启）

## 完整指令速查表

### 掷骰指令
```
r <表达式>          # 基础掷骰
rh <表达式>         # 隐藏掷骰
adv [修正]          # 优势掷骰
dis [修正]          # 劣势掷骰
rn <次数> <表达式>  # 多次掷骰
ex <表达式>         # 爆炸骰
fate [参数]         # Fate骰子
```

### 检定指令
```
ra <技能> [值]      # 技能检定
rah <技能> [值]     # 隐藏检定
rav <技能1>vs<技能2> # 对抗检定
coc <值> [难度]     # CoC检定
san <理智> <损失>   # 理智检定
check <属性> [熟练] # D&D能力检定
save <属性> [熟练]  # D&D豁免检定
wod <骰池> [难度]   # WoD骰池检定
```

### 角色管理
```
st                  # 显示角色卡
st new <名字> [系统] # 创建角色卡
st set <名字>       # 切换角色卡
st <属性> <值>      # 设置属性
hp [操作]           # 生命值管理
init [修正]         # 先攻检定
```

### 角色生成
```
cocchar             # CoC角色生成
dndchar             # D&D角色生成
name [参数]         # 随机姓名
```

### 辅助功能
```
madness [类型]      # 疯狂症状
jrrp                # 今日人品
draw [数量]         # 抽卡
ri [操作]           # 先攻追踪
me <动作>           # 角色动作
```

### 系统指令
```
bot [on/off]        # 机器人状态
help trpg           # 查看帮助
```

## 使用示例

```bash
# 基础掷骰
r d20+5           # 掷d20+5
r 3d6             # 掷3d6
r 1d8+1d6+2       # 掷1d8+1d6+2

# 角色检定
ra 侦察           # 侦察检定
coc 65            # CoC普通检定
rav 心理学vs欺骗  # 对抗检定

# 角色管理
st new 艾莉娅 CoC # 创建CoC角色卡
st 力量 65        # 设置力量65
hp +5             # 恢复5点生命值

# 高级功能
adv +3            # 优势d20+3
rn 3 d6           # 掷3次d6
ex d10            # d10爆炸骰

# 角色生成
cocchar           # 生成CoC角色
name 女 3         # 生成3个女性姓名

# 角色扮演
me 小心翼翼地检查陷阱
```

## 注意事项

1. 所有指令需要管理员权限或在允许的环境中使用
2. 角色数据会自动保存到数据库
3. 大成功/大失败的判定基于骰子原始值
4. 爆炸骰有防无限循环机制（最多10次）
5. 支持中文属性名和技能名
6. 对抗检定支持多种格式输入
7. 今日人品值基于用户ID和日期生成，每日固定

这个TRPG骰子系统提供了完整的跑团支持，功能覆盖度已达到OlivaDice的水平，能够满足各种TRPG系统的需求。